"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[3650],{39470:(ca,re,r)=>{r.r(re),r.d(re,{default:()=>_t});var e=r(32735),De=r(99357),F=r(5636),y=r(88425),u=r(88133),oe=r(19615),V=r(5141),T=r(11856),Te=r(16540),Z=r(9808),xe=r(27635),Re=r(35980),je=r(28004),He=r(20763),x=r(95602),$=r(78330),z=r(19192),Ne=r(95717),Qe=r.n(Ne),Ue=r(86588),Ve=r(61405),Ze=r(8639),$e=r(94553),ze=r(90312),We=r(89581),Ge=r(37293),Ke=r(77935),Je=r(60216),f=r.n(Je);const W=({pagination:n})=>e.createElement(Z.Box,{paddingTop:6},e.createElement(z.Flex,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(y.PageSizeURLQuery,null),e.createElement(y.PaginationURLQuery,{pagination:n})));W.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},W.propTypes={pagination:f().shape({page:f().number,pageCount:f().number,pageSize:f().number,total:f().number})};var Xe=r(46891),Ye=r(36156),G=r(90662),h=r(68781),we=r(20069),S=r(44526),ke=r(76470),qe=r.n(ke),_e=r(81094),et=(n,t,a)=>new Promise((d,s)=>{var i=o=>{try{l(a.next(o))}catch(v){s(v)}},m=o=>{try{l(a.throw(o))}catch(v){s(v)}},l=o=>o.done?d(o.value):Promise.resolve(o.value).then(i,m);l((a=a.apply(n,t)).next())});const se=({selected:n,onSuccess:t})=>{const{formatMessage:a}=(0,F.useIntl)(),[d,s]=(0,e.useState)(!1),{isLoading:i,remove:m}=(0,_e.K)(),l=()=>et(void 0,null,function*(){yield m(n),t()});return e.createElement(e.Fragment,null,e.createElement(S.Button,{variant:"danger-light",size:"S",startIcon:e.createElement(qe(),null),onClick:()=>s(!0)},a({id:"global.delete",defaultMessage:"Delete"})),e.createElement(y.ConfirmDialog,{isConfirmButtonLoading:i,isOpen:d,onToggleDialog:()=>s(!1),onConfirm:l}))};se.propTypes={selected:f().arrayOf(h.pw,h.nx).isRequired,onSuccess:f().func.isRequired};var tt=r(44474),at=r.n(tt),nt=r(83281),rt=r(86834),ot=r.n(rt),st=r(82910),b=r(4122),lt=r(20001),le=r(84968),K=r(74951),it=Object.defineProperty,dt=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,ut=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable,de=(n,t,a)=>t in n?it(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,ce=(n,t)=>{for(var a in t||(t={}))ut.call(t,a)&&de(n,a,t[a]);if(ie)for(var a of ie(t))mt.call(t,a)&&de(n,a,t[a]);return n},ue=(n,t)=>dt(n,ct(t));const ft=()=>{const n=(0,y.useNotification)(),t=(0,le.useQueryClient)(),a=(0,u.IF)("actions/bulk-move"),d=({destinationFolderId:m,filesAndFolders:l})=>{const o=l.reduce((v,O)=>{const{id:E,type:g}=O,P=g==="asset"?"fileIds":"folderIds";return v[P]||(v[P]=[]),v[P].push(E),v},{});return u.be.post(a,ue(ce({},o),{destinationFolderId:m}))},s=(0,le.useMutation)(d,{onSuccess(m){var l;const{data:{data:o}}=m;((l=o==null?void 0:o.files)==null?void 0:l.length)>0&&(t.refetchQueries([K.Z,"assets"],{active:!0}),t.refetchQueries([K.Z,"asset-count"],{active:!0})),t.refetchQueries([K.Z,"folders"],{active:!0}),n({type:"success",message:{id:(0,u.OB)("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."}})}}),i=(m,l)=>s.mutateAsync({destinationFolderId:m,filesAndFolders:l});return ue(ce({},s),{move:i})};var vt=r(21375),gt=r(72236),pt=(n,t,a)=>new Promise((d,s)=>{var i=o=>{try{l(a.next(o))}catch(v){s(v)}},m=o=>{try{l(a.throw(o))}catch(v){s(v)}},l=o=>o.done?d(o.value):Promise.resolve(o.value).then(i,m);l((a=a.apply(n,t)).next())});const J=({onClose:n,selected:t,currentFolder:a})=>{const{formatMessage:d}=(0,F.useIntl)(),{data:s,isLoading:i}=(0,gt.v)(),{move:m}=ft();if(!s)return null;const l=(O,E)=>pt(void 0,[O,E],function*(g,{setErrors:P}){try{yield m(g.destination.value,t),n()}catch(N){const p=(0,y.getAPIInnerErrors)(N,{getTrad:u.OB}),D=Object.entries(p).reduce((A,[M,q])=>(A[M||"destination"]=q.defaultMessage,A),{});ot()(D)||P(D)}}),o=()=>{n()};if(i)return e.createElement(b.ModalLayout,{onClose:o,labelledBy:"title"},e.createElement(b.ModalBody,null,e.createElement(z.Flex,{justifyContent:"center",paddingTop:4,paddingBottom:4},e.createElement(st.Loader,null,d({id:(0,u.OB)("content.isLoading"),defaultMessage:"Content is loading."})))));const v={destination:{value:(a==null?void 0:a.id)||"",label:(a==null?void 0:a.name)||s[0].label}};return e.createElement(b.ModalLayout,{onClose:o,labelledBy:"title"},e.createElement(nt.Formik,{validateOnChange:!1,onSubmit:l,initialValues:v},({values:O,errors:E,setFieldValue:g})=>e.createElement(y.Form,{noValidate:!0},e.createElement(b.ModalHeader,null,e.createElement(x.Typography,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"title"},d({id:(0,u.OB)("modal.folder.move.title"),defaultMessage:"Move elements to"}))),e.createElement(b.ModalBody,null,e.createElement($.Grid,{gap:4},e.createElement($.GridItem,{xs:12,col:12},e.createElement(G.Stack,{spacing:1},e.createElement(lt.FieldLabel,{htmlFor:"folder-destination"},d({id:(0,u.OB)("form.input.label.folder-location"),defaultMessage:"Location"})),e.createElement(vt.Z,{options:s,onChange:P=>{g("destination",P)},defaultValue:O.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:E==null?void 0:E.destination,ariaErrorMessage:"destination-error"}),E.destination&&e.createElement(x.Typography,{variant:"pi",as:"p",id:"folder-destination-error",textColor:"danger600"},E.destination))))),e.createElement(b.ModalFooter,{startActions:e.createElement(S.Button,{onClick:o,variant:"tertiary",name:"cancel"},d({id:"cancel",defaultMessage:"Cancel"})),endActions:e.createElement(S.Button,{type:"submit",loading:i},d({id:"modal.folder.move.submit",defaultMessage:"Move"}))}))))};J.defaultProps={currentFolder:void 0},J.propTypes={onClose:f().func.isRequired,currentFolder:h.nx,selected:f().arrayOf(h.nx,h.pw).isRequired};const X=({selected:n,onSuccess:t,currentFolder:a})=>{const{formatMessage:d}=(0,F.useIntl)(),[s,i]=(0,e.useState)(!1),m=()=>{i(!1),t()};return e.createElement(e.Fragment,null,e.createElement(S.Button,{variant:"secondary",size:"S",startIcon:e.createElement(at(),null),onClick:()=>i(!0)},d({id:"global.move",defaultMessage:"Move"})),s&&e.createElement(J,{currentFolder:a,onClose:m,selected:n}))};X.defaultProps={currentFolder:void 0},X.propTypes={onSuccess:f().func.isRequired,currentFolder:h.nx,selected:f().arrayOf(h.pw,h.nx).isRequired};const Y=({selected:n,onSuccess:t,currentFolder:a})=>{const{formatMessage:d}=(0,F.useIntl)();return e.createElement(G.Stack,{horizontal:!0,spacing:2,paddingBottom:5},e.createElement(x.Typography,{variant:"epsilon",textColor:"neutral600"},d({id:(0,we.Z)("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:n.filter(({type:s})=>s==="folder").length,numberAssets:n.filter(({type:s})=>s==="asset").length})),e.createElement(se,{selected:n,onSuccess:t}),e.createElement(X,{currentFolder:a,selected:n,onSuccess:t}))};Y.defaultProps={currentFolder:void 0},Y.propTypes={onSuccess:f().func.isRequired,currentFolder:h.nx,selected:f().arrayOf(h.pw,h.nx).isRequired};var R=r(47359),yt=r(23899),Et=r.n(yt),ht=r(79996),Ot=r(90768),me=r(90142);const Pt=()=>{var n;const t=(0,e.useRef)(null),[a,d]=(0,e.useState)(!1),{formatMessage:s}=(0,F.useIntl)(),{trackUsage:i}=(0,y.useTracking)(),[{query:m},l]=(0,y.useQueryParams)(),o=((n=m==null?void 0:m.filters)==null?void 0:n.$and)||[],v=()=>d(g=>!g),O=g=>{l({filters:{$and:g},page:1})},E=g=>{i("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(g[g.length-1])[0]}),l({filters:{$and:g},page:1})};return e.createElement(e.Fragment,null,e.createElement(S.Button,{variant:"tertiary",ref:t,startIcon:e.createElement(Et(),null),onClick:v,size:"S"},s({id:"app.utils.filters",defaultMessage:"Filters"})),a&&e.createElement(Ot.Z,{displayedFilters:me.Z,filters:o,onSubmit:E,onToggle:v,source:t}),e.createElement(ht.Z,{appliedFilters:o,filtersSchema:me.Z,onRemoveFilter:O}))};var Mt=r(77997),Ft=r(58434),Ct=r(98599),Lt=r.n(Ct),Bt=r(59290),w=r.n(Bt),St=r(17837),At=Object.defineProperty,bt=Object.defineProperties,It=Object.getOwnPropertyDescriptors,fe=Object.getOwnPropertySymbols,Dt=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable,ve=(n,t,a)=>t in n?At(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,xt=(n,t)=>{for(var a in t||(t={}))Dt.call(t,a)&&ve(n,a,t[a]);if(fe)for(var a of fe(t))Tt.call(t,a)&&ve(n,a,t[a]);return n},Rt=(n,t)=>bt(n,It(t));const k=({breadcrumbs:n,canCreate:t,folder:a,onToggleEditFolderDialog:d,onToggleUploadAssetDialog:s})=>{var i,m;const{formatMessage:l}=(0,F.useIntl)(),{pathname:o}=(0,V.useLocation)(),[{query:v}]=(0,y.useQueryParams)(),O=Rt(xt({},v),{folder:(m=(i=a==null?void 0:a.parent)==null?void 0:i.id)!=null?m:void 0});return e.createElement(T.HeaderLayout,{title:l({id:(0,u.OB)("plugin.name"),defaultMessage:"Media Library"}),subtitle:n&&a&&e.createElement(St.O,{as:"nav",label:l({id:(0,u.OB)("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:n,currentFolderId:a==null?void 0:a.id}),navigationAction:a&&e.createElement(Ft.Link,{startIcon:e.createElement(Lt(),null),to:`${o}?${(0,Mt.stringify)(O,{encode:!1})}`},l({id:(0,u.OB)("header.actions.folder-level-up"),defaultMessage:"Back"})),primaryAction:t&&e.createElement(G.Stack,{horizontal:!0,spacing:2},e.createElement(S.Button,{startIcon:e.createElement(w(),null),variant:"secondary",onClick:d},l({id:(0,u.OB)("header.actions.add-folder"),defaultMessage:"Add new folder"})),e.createElement(S.Button,{startIcon:e.createElement(w(),null),onClick:s},l({id:(0,u.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})))})};k.defaultProps={breadcrumbs:!1,folder:null},k.propTypes={breadcrumbs:f().oneOfType([h.Fv,f().bool]),canCreate:f().bool.isRequired,folder:h.nx,onToggleEditFolderDialog:f().func.isRequired,onToggleUploadAssetDialog:f().func.isRequired};var jt=r(64472),Ht=r.n(jt),Nt=r(1920),Qt=Object.defineProperty,Ut=Object.defineProperties,Vt=Object.getOwnPropertyDescriptors,ge=Object.getOwnPropertySymbols,Zt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable,pe=(n,t,a)=>t in n?Qt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,zt=(n,t)=>{for(var a in t||(t={}))Zt.call(t,a)&&pe(n,a,t[a]);if(ge)for(var a of ge(t))$t.call(t,a)&&pe(n,a,t[a]);return n},Wt=(n,t)=>Ut(n,Vt(t));const Gt=({isFiltering:n,canCreate:t,canRead:a})=>n?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:a?t?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},ye=({canCreate:n,isFiltering:t,canRead:a,onActionClick:d})=>{const{formatMessage:s}=(0,F.useIntl)(),i=Gt({isFiltering:t,canCreate:n,canRead:a});return e.createElement(Nt.i,{icon:a?null:Ht(),action:n&&!t&&e.createElement(S.Button,{variant:"secondary",startIcon:e.createElement(w(),null),onClick:d},s({id:(0,u.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})),content:s(Wt(zt({},i),{id:(0,u.OB)(i.id)}))})};ye.propTypes={canCreate:f().bool.isRequired,canRead:f().bool.isRequired,isFiltering:f().bool.isRequired,onActionClick:f().func.isRequired};var Kt=Object.defineProperty,Jt=Object.defineProperties,Xt=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertySymbols,Yt=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable,he=(n,t,a)=>t in n?Kt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,j=(n,t)=>{for(var a in t||(t={}))Yt.call(t,a)&&he(n,a,t[a]);if(Ee)for(var a of Ee(t))wt.call(t,a)&&he(n,a,t[a]);return n},H=(n,t)=>Jt(n,Xt(t));const kt=(0,oe.default)(Z.Box)`
  height: ${32/16}rem;
  display: flex;
  align-items: center;
`,Oe=(0,oe.default)(x.Typography)`
  max-width: 100%;
`,qt=()=>{var n,t,a,d;const{push:s}=(0,V.useHistory)(),{canRead:i,canCreate:m,canUpdate:l,canCopyLink:o,canDownload:v,isLoading:O}=(0,Xe.y)(),E=(0,e.useRef)(),{formatMessage:g}=(0,F.useIntl)(),{pathname:P}=(0,V.useLocation)(),{trackUsage:N}=(0,y.useTracking)(),[{query:p},D]=(0,y.useQueryParams)(),A=Boolean(p._q||p.filters),{data:M,isLoading:q,errors:ea}=(0,Ge.L)({skipWhen:!i,query:p}),{data:Q,isLoading:ta,errors:aa}=(0,Ke.j)({enabled:i&&((n=M==null?void 0:M.pagination)==null?void 0:n.page)===1&&!(0,u.rV)(p),query:p}),{data:_,isLoading:Pe,error:Me}=(0,Ye.W)(p==null?void 0:p.folder,{enabled:i&&!!(p!=null&&p.folder)});((t=Me==null?void 0:Me.response)==null?void 0:t.status)===404&&s(P);const C=(Q==null?void 0:Q.length)||0,U=M==null?void 0:M.results,L=(a=U==null?void 0:U.length)!=null?a:0,Fe=Pe||ta||O||q,[na,ra]=(0,e.useState)(!1),[oa,Ce]=(0,e.useState)(!1),[Le,Be]=(0,e.useState)(void 0),[ee,Se]=(0,e.useState)(void 0),[B,{selectOne:te,selectAll:Ae}]=(0,y.useSelectionState)(["type","id"],[]),ae=()=>ra(c=>!c),be=({created:c=!1}={})=>{c&&(p==null?void 0:p.page)!=="1"&&D(H(j({},p),{page:1})),Ce(I=>!I)},sa=c=>{N("didSortMediaLibraryElements",{location:"upload",sort:c}),D({sort:c})},la=c=>{Se(c),Ce(!0)},ia=c=>{Se(null),be(c),E.current&&E.current.focus()};return(0,y.useFocusWhenNavigate)(),e.createElement(T.Layout,null,e.createElement(Te.Main,{"aria-busy":Fe},e.createElement(k,{breadcrumbs:!Pe&&(0,u.M4)(_,{pathname:P,query:p}),canCreate:m,onToggleEditFolderDialog:be,onToggleUploadAssetDialog:ae,folder:_}),e.createElement(T.ActionLayout,{startActions:e.createElement(e.Fragment,null,l&&(L>0||C>0)&&e.createElement(kt,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200"},e.createElement(Re.BaseCheckbox,{"aria-label":g({id:(0,u.OB)("bulk.select.label"),defaultMessage:"Select all folders & assets"}),indeterminate:(B==null?void 0:B.length)>0&&(B==null?void 0:B.length)!==L+C,value:(L>0||C>0)&&B.length===L+C,onChange:c=>{c.target.checked&&N("didSelectAllMediaLibraryElements"),Ae([...U.map(I=>H(j({},I),{type:"asset"})),...Q.map(I=>H(j({},I),{type:"folder"}))])}})),i&&e.createElement(We.Z,{onChangeSort:sa}),i&&e.createElement(Pt,null)),endActions:e.createElement(y.SearchURLQuery,{label:g({id:(0,u.OB)("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})}),e.createElement(T.ContentLayout,null,B.length>0&&e.createElement(Y,{currentFolder:_,selected:B,onSuccess:Ae}),Fe&&e.createElement(y.LoadingIndicatorPage,null),(ea||aa)&&e.createElement(y.AnErrorOccurred,null),C===0&&L===0&&e.createElement(ye,{canCreate:m,canRead:i,isFiltering:A,onActionClick:ae}),i&&e.createElement(e.Fragment,null,C>0&&e.createElement(ze.$,{title:(A&&L>0||!A)&&g({id:(0,u.OB)("list.folders.title"),defaultMessage:"Folders ({count})"},{count:C})||""},Q.map(c=>{const da=!!B.filter(({type:ne})=>ne==="folder").find(ne=>ne.id===c.id),Ie=(0,u.Km)(P,p,c);return e.createElement($.GridItem,{col:3,key:`folder-${c.id}`},e.createElement(R.Ac,{ref:ee&&c.id===ee.id?E:void 0,ariaLabel:c.name,id:`folder-${c.id}`,to:Ie,startAction:te&&e.createElement(R.MM,{"data-testid":`folder-checkbox-${c.id}`,value:da,onChange:()=>te(H(j({},c),{type:"folder"}))}),cardActions:e.createElement(He.IconButton,{icon:e.createElement(Qe(),null),"aria-label":g({id:(0,u.OB)("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>la(c)})},e.createElement(R.Bu,null,e.createElement(R.u6,{to:Ie},e.createElement(z.Flex,{as:"h2",direction:"column",alignItems:"start",maxWidth:"100%"},e.createElement(Oe,{fontWeight:"semiBold",ellipsis:!0},c.name,e.createElement(je.VisuallyHidden,null,":")),e.createElement(Oe,{as:"span",textColor:"neutral600",variant:"pi",ellipsis:!0},g({id:(0,u.OB)("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:c.children.count,filesCount:c.files.count})))))))})),L>0&&C>0&&e.createElement(Z.Box,{paddingTop:6,paddingBottom:4},e.createElement(xe.Divider,null)),L>0&&e.createElement(e.Fragment,null,e.createElement($e.l,{assets:U,onEditAsset:Be,onSelectAsset:te,selectedAssets:B.filter(({type:c})=>c==="asset"),title:(!A||A&&C>0)&&((d=M==null?void 0:M.pagination)==null?void 0:d.page)===1&&g({id:(0,u.OB)("list.assets.title"),defaultMessage:"Assets ({count})"},{count:L})||""}),(M==null?void 0:M.pagination)&&e.createElement(W,{pagination:M.pagination}))))),na&&e.createElement(Ue.x,{onClose:ae,trackedLocation:"upload",folderId:p==null?void 0:p.folder}),oa&&e.createElement(Ve.f,{onClose:ia,folder:ee,parentFolderId:p==null?void 0:p.folder,location:"upload"}),Le&&e.createElement(Ze.s,{onClose:()=>Be(void 0),asset:Le,canUpdate:l,canCopyLink:o,canDownload:v,trackedLocation:"upload"}))},_t=()=>{const[{rawQuery:n},t]=(0,y.useQueryParams)(),{formatMessage:a}=(0,F.useIntl)(),d=a({id:(0,u.OB)("plugin.name"),defaultMessage:"Media Library"});return(0,e.useEffect)(()=>{n||t({sort:"updatedAt:DESC",page:1,pageSize:10})},[n,t]),n?e.createElement(e.Fragment,null,e.createElement(De.Helmet,{title:d}),e.createElement(qt,null)):null}}}]);
